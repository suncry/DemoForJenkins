# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

default_platform(:ios)


def updateProjectBuildNumber

currentTime = Time.new.strftime("%Y%m%d")
build = get_build_number()
if build.include?"#{currentTime}."
# => ä¸ºå½“å¤©ç‰ˆæœ¬ è®¡ç®—è¿­ä»£ç‰ˆæœ¬å·
lastStr = build[build.length-2..build.length-1]
lastNum = lastStr.to_i
lastNum = lastNum + 1
lastStr = lastNum.to_s
if lastNum < 10
lastStr = lastStr.insert(0,"0")
end
build = "#{currentTime}.#{lastStr}"
else
# => éå½“å¤©ç‰ˆæœ¬ build å·é‡ç½®
build = "#{currentTime}.01"
end
puts("*************| æ›´æ–°build #{build} |*************")
# => æ›´æ”¹é¡¹ç›® build å·
increment_build_number(
build_number: "#{build}"
)
end

#æŒ‡å®šé¡¹ç›®çš„schemeåç§°
scheme="MedlinkerLite"
#è’²å…¬è‹±api_keyå’Œuser_key
api_key="87a96feb51f5ecdfafc2bc4c9eeb045a"
user_key="dad6308763eece8035c49ea33e676138"

# ä»»åŠ¡è„šæœ¬
platform :ios do
lane :development_build do |options|
branch = options[:branch]

puts "å¼€å§‹æ‰“development ipa"

updateProjectBuildNumber #æ›´æ”¹é¡¹ç›®buildå·

# å¼€å§‹æ‰“åŒ…
gym(
#è¾“å‡ºçš„ipaåç§°
output_name:"#{scheme}_#{get_build_number()}",
# æ˜¯å¦æ¸…ç©ºä»¥å‰çš„ç¼–è¯‘ä¿¡æ¯ trueï¼šæ˜¯
clean:true,
# æŒ‡å®šæ‰“åŒ…æ–¹å¼ï¼ŒRelease æˆ–è€… Debug
configuration:"Release",
# æŒ‡å®šæ‰“åŒ…æ‰€ä½¿ç”¨çš„è¾“å‡ºæ–¹å¼ï¼Œç›®å‰æ”¯æŒapp-store, package, ad-hoc, enterprise, development
export_method:"development",
# æŒ‡å®šè¾“å‡ºæ–‡ä»¶å¤¹
output_directory:"./fastlane/build",
)

puts "å¼€å§‹ä¸Šä¼ è’²å…¬è‹±"
# å¼€å§‹ä¸Šä¼ è’²å…¬è‹±
pgyer(api_key: "#{api_key}", user_key: "#{user_key}")

end
end
